
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Introducing Simple Analytics</title>
    <meta name="description" content="">

    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="shortcut icon" href="../favicon.ico">

    <link rel="stylesheet" type="text/css" href="../assets/css/screen.css?v=d03024f356">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic%7COpen+Sans:700,400">

    <link rel="canonical" href="http://138.68.15.179/introducing-simple-analytics/">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <link rel="amphtml" href="http://138.68.15.179/introducing-simple-analytics/amp/">
    
    <meta property="og:site_name" content="Theoretical Ideations">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Introducing Simple Analytics">
    <meta property="og:description" content="Time for something different, let’s talk web stuff! I mentioned a while ago that I switched from Wordpress to Ghost Blog. Overall I really like Ghost Blog so far, but there is one key feature that Ghost lacks that Wordpress has: site analytics. Yes I know I can use">
    <meta property="og:url" content="http://138.68.15.179/introducing-simple-analytics/">
    <meta property="article:published_time" content="2014-05-08T17:23:14.000Z">
    <meta property="article:modified_time" content="2014-10-23T05:20:06.000Z">
    <meta property="article:tag" content="JavaScript">
    
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Introducing Simple Analytics">
    <meta name="twitter:description" content="Time for something different, let’s talk web stuff! I mentioned a while ago that I switched from Wordpress to Ghost Blog. Overall I really like Ghost Blog so far, but there is one key feature that Ghost lacks that Wordpress has: site analytics. Yes I know I can use">
    <meta name="twitter:url" content="http://138.68.15.179/introducing-simple-analytics/">
    <meta name="twitter:label1" content="Written by">
    <meta name="twitter:data1" content="Bryan Hughes">
    <meta name="twitter:label2" content="Filed under">
    <meta name="twitter:data2" content="JavaScript">
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "Theoretical Ideations",
        "logo": "http://138.68.15.179/ghost/img/ghosticon.jpg"
    },
    "author": {
        "@type": "Person",
        "name": "Bryan Hughes",
        "image": {
            "@type": "ImageObject",
            "url": "//www.gravatar.com/avatar/b2c8ee28e90a3e97ba056d444114bb06?s=250&d=mm&r=x",
            "width": 250,
            "height": 250
        },
        "url": "http://138.68.15.179/author/bryan-hughes/",
        "sameAs": [
            "https://github.com/bryan-m-hughes"
        ],
        "description": "I&#x27;m a web framework dev at Rdio and love JavaScript! I&#x27;m also an amateur photographer, avid gamer, film enthusiast, wine lover, and very lucky husband!"
    },
    "headline": "Introducing Simple Analytics",
    "url": "http://138.68.15.179/introducing-simple-analytics/",
    "datePublished": "2014-05-08T17:23:14.000Z",
    "dateModified": "2014-10-23T05:20:06.000Z",
    "keywords": "JavaScript",
    "description": "Time for something different, let’s talk web stuff! I mentioned a while ago that I switched from Wordpress to Ghost Blog. Overall I really like Ghost Blog so far, but there is one key feature that Ghost lacks that Wordpress has: site analytics. Yes I know I can use",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "http://138.68.15.179"
    }
}
    </script>

    <meta name="generator" content="Ghost 0.11">
    <link rel="alternate" type="application/rss+xml" title="Theoretical Ideations" href="http://138.68.15.179/rss/">
</head>
<body class="post-template tag-javascript nav-closed">

    <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="index.html#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
            <li class="nav-home" role="presentation"><a href="http://138.68.15.179/">Home</a></li>
    </ul>
        <a class="subscribe-button icon-feed" href="http://138.68.15.179/rss/">Subscribe</a>
</div>
<span class="nav-cover"></span>


    <div class="site-wrapper">

        


<header class="main-header post-head no-cover">
    <nav class="main-nav  clearfix">
        
            <a class="menu-button icon-menu" href="index.html#"><span class="word">Menu</span></a>
    </nav>
</header>

<main class="content" role="main">
    <article class="post tag-javascript">

        <header class="post-header">
            <h1 class="post-title">Introducing Simple Analytics</h1>
            <section class="post-meta">
                <time class="post-date" datetime="2014-05-08">08 May 2014</time>  on <a href="../tag/javascript/">JavaScript</a>
            </section>
        </header>

        <section class="post-content">
            <p>Time for something different, let’s talk web stuff! I mentioned a while ago that I <a href="https://theoreticalideations.com/2014/03/11/im-moving-to-ghost-blog/">switched from Wordpress to Ghost Blog</a>. Overall I really like Ghost Blog so far, but there is one key feature that Ghost lacks that Wordpress has: site analytics. Yes I know I can use Google Analytics or something similar, but it doesn’t give me the detailed per-page information that I prefer. So I wrote my own analytics engine.</p>

<p>It’s called Simple Analytics, and you can find it on GitHub repository at <a href="https://github.com/bryan-m-hughes/simple-analytics">https://github.com/bryan-m-hughes/simple-analytics</a>.</p>

<p>I call it Simple Analytics because it’s meant to be pretty no-frills, and really is just a stop-gap solution until Ghost implements its dashboard feature sometime early next year. It’s been effective so far though. Here’s a screenshot of what it looks like:</p>

<p><img src="../static/simple-analytics.png" alt="Simple Analytics Screenshot"></p>

<p>One of the key reasons that I had for writing my own analytics server (aside from the fact that it was just fun), is that my blog server only has Node.js installed on it and I intend to keep it that way. I found plenty of PHP based solutions, but nothing written in Node.js that didn’t rely on a third party service. So that was my first requirement.</p>

<p>Another feature that I really liked from the Wordpress stats was that they were (more or less) real-time, unlike Google Analytics, so that was my second requirement.</p>

<p>My third requirement was that I wanted to make sure that only I could access my stats, which means I needed an authentication mechanism.</p>

<p>So with my requirements in place, I set out to write the analytics service. Since I’m the only one accessing the site analytics, that means there was no need to make sure that serving the analytics data didn’t need to be optimized, only storing data from page visits. As a result, the architecture sacrifices the performance of serving analytics data to make saving analytics data faster.</p>

<p>I know my traffic levels pretty well, and I also know that the Digital Ocean droplet hosting my blog has an SSD in it, meaning I get pretty good disk write performance. These things together means that I have no need for any sort of high-performance database storage, so I opted to just store everything in JSON files to keep things simple.</p>

<p>This approach does mean it won’t scale to needs beyond my own very easily, but I architected everything pretty carefully to avoid race conditions, resource contention etc so that it’s at least stable. Honestly Node.js makes this really easy given it’s single-threaded nature.</p>

<p>When someone visits my blog, their browser sends an XHR request back to my analytics server, which is running on the same Digital Ocean droplet as this blog itself. This small packet contains the page that was viewed, calculated on the client. The server stores the page, along with the server’s wall-time, into an in-memory data structure (just an object literal in JavaScript parlance).</p>

<p>Every time this in-memory object is modified, it serializes the data to a JSON file. The serialization mechanism is asynchronous for performance reasons. Since it’s asynchronous, I added a lock around it to make sure I didn’t write to the file while I was writing to the file. The file is treated as a back-up of in-memory contents, and so is only read on server start-up. As a result, this means it’s OK if it is temporarily out of sync with memory. There is a chance for data loss if the server crashes (this is where a proper database would help since file writing isn't atomic in Node.js), but it’s a risk I’m willing to take since this data isn’t mission critical. Plus, that’s what server backups are for!</p>

<p>Authentication is a home-grown mechanism. I could have used a third party module, but to be honest I kinda wanted to write my own to see what it’s like! To keep it simple and severely lessen the chance of a security breach, Simple Analytics supports only a single user, and that user is created off-line before the server is started for the first time. The username and password are salted and hashed with pbkdf2 using Node.js’ crypto module. When a user logs in, an access token is created and stored in a cookie in the user’s browser so that I don’t have to continually re-log in. I kept this code as simple and straightforward as possible to reduce the surface area for bugs and security holes. I actually spent the most time on this part of the project, even though it’s a relatively small part of the codebase.</p>

<p>Finally, there is the actual webpage itself. It’s served as a completely static page, so there is no Backbone, Angular, or Ember. I created a <a href="http://mustache.github.io/">mustache</a> template that the server fills in with data at request time. All analytics data is calculated at request time instead of caching to keep the code simple. Since I’m the only one requesting data, and I only do it a few times a day, request performance isn’t important. The graph at the top of the page is handled using <a href="http://www.chartjs.org/">Chart.js</a>.</p>

<p>So that’s Simple Analytics. It took me about two weeks to write, and honestly was a lot of fun! I have plans to optimize the write performance of the server, but other than that I don’t really plan on doing much else to it. It has already handled a day where a blog post was retweeted by Ashe Dryden, which caused a (greatly appreciated) surge in traffic. Simple Analytics had no problems handling the surge, and I haven’t really had any interface annoyances that compel me to change anything.</p>

<p>If you want to check it out yourself, installation instructions are in the <a href="https://github.com/bryan-m-hughes/simple-analytics">README</a> on Gitlab.</p>
        </section>

        <footer class="post-footer">


            <figure class="author-image">
                <a class="img" href="../author/bryan-hughes/" style="background-image: url(https://www.gravatar.com/avatar/b2c8ee28e90a3e97ba056d444114bb06?s&amp;)"><span class="hidden">Bryan Hughes's Picture</span></a>
            </figure>

            <section class="author">
                <h4><a href="../author/bryan-hughes/">Bryan Hughes</a></h4>

                    <p>I'm a web framework dev at Rdio and love JavaScript! I'm also an amateur photographer, avid gamer, film enthusiast, wine lover, and very lucky husband!</p>
                <div class="author-meta">
                    <span class="author-location icon-location">San Francisco, CA</span>
                    <span class="author-link icon-link"><a href="https://github.com/bryan-m-hughes">https://github.com/bryan-m-hughes</a></span>
                </div>
            </section>


            <section class="share">
                <h4>Share this post</h4>
                <a class="icon-twitter" href="https://twitter.com/intent/tweet?text=Introducing%20Simple%20Analytics&amp;url=http://138.68.15.179/introducing-simple-analytics/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <span class="hidden">Twitter</span>
                </a>
                <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://138.68.15.179/introducing-simple-analytics/" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <span class="hidden">Facebook</span>
                </a>
                <a class="icon-google-plus" href="https://plus.google.com/share?url=http://138.68.15.179/introducing-simple-analytics/" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <span class="hidden">Google+</span>
                </a>
            </section>


        </footer>

    </article>
</main>

<aside class="read-next">
    <a class="read-next-story no-cover" href="../i-am-an-atheist/">
        <section class="post">
            <h2>I am an atheist</h2>
            <p>Yes, I, Bryan Hughes, am an atheist, and have been for about 6-7 years now. I'm sure there are…</p>
        </section>
    </a>
    <a class="read-next-story prev no-cover" href="../why-im-leaving-github/">
        <section class="post">
            <h2>Why I'm Leaving GitHub</h2>
            <p>I am unhappy with GitHub. It’s not because of any technical issues of the service, I’ve had…</p>
        </section>
    </a>
</aside>



        <footer class="site-footer clearfix">
            <section class="copyright"><a href="http://138.68.15.179">Theoretical Ideations</a> © 2018</section>
            <section class="poweredby">Proudly published with <a href="https://ghost.org">Ghost</a></section>
        </footer>

    </div>

    <script type="text/javascript" src="https://code.jquery.com/jquery-1.12.0.min.js"></script>
    
    <script type="text/javascript" src="../assets/js/jquery.fitvids.js?v=d03024f356"></script>
    <script type="text/javascript" src="../assets/js/index.js?v=d03024f356"></script>

</body>
